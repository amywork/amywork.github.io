---
layout: post
title: "ARC - ë©”ëª¨ë¦¬ ê´€ë¦¬"
author: "Amy"
---

# ê¸°ì¡´ ë©”ëª¨ë¦¬ ê´€ë¦¬ ë°©ì‹
- **ëª…ì‹œì  í•´ì œ** : ë©”ëª¨ë¦¬ì— ì €ì¥ëœ ë³€ìˆ˜ë¥¼ ê°œë°œìê°€ ëª¨ë‘ ê´€ë¦¬ **(alloc init/retain -> release)**- **ê°€ë¹„ì§€ì½œë ‰í„°** : ê°€ë¹„ì§€ ì½œë ‰í„°ê°€ ìˆ˜ì‹œë¡œ í™•ì¸í•´ì„œ ì•ˆì“°ëŠ” ê°ì²´ ë ˆí¼ëŸ°ìŠ¤ í•´ì œ 
- **ë ˆí¼ëŸ°ìŠ¤ ì¹´ìš´íŒ…** : ì˜¤ë„ˆì‰½ ì •ì±…ì— ì˜í•´ ê°ì²´ì˜ í•´ì œ(release) ì •ì˜

## Reference counting?
- **ì¸ìŠ¤í„´ìŠ¤ ê°ì²´ì˜ ì˜¤ë„ˆë§Œ**ì´ í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ì˜ í•´ì œì— ëŒ€í•´ ì±…ì„
- ì˜¤ë„ˆì‰½ì„ ê°€ì§„ ê°ì²´ì— ëŒ€í•´ì„œë§Œ reference countê°€ ì¦ê°€

## ì˜ˆì œ
- 2ë²ˆì§¸ ì¤„ì—ì„œ ìƒê¸´ ì¸ìŠ¤í„´ìŠ¤ì˜ ë©”ëª¨ë¦¬ë¥¼ í•´ì œí•  ë°©ë²•ì´ ì—†ë‹¤.

```
NSString *str1 = [[NSString alloc] init];NSString *str2 = [[NSString alloc] init];NSString *str3 = [[NSString alloc] init];str2 = [[NSString alloc] init];[str1 release];[str2 release];[str3 release];
```

# ğŸ‘ğŸ» ARC: Automatic Reference Counting
- 11ë…„ WWDC ë°œí‘œ ì´í›„, ê¸°ì¡´ì— ìˆ˜ë™(MRC)ìœ¼ë¡œ ê°œë°œìê°€ ì§ì ‘ release(í•´ì œ)ë¥¼ í†µí•´ reference countingì„ ê´€ë¦¬í•´ì•¼ í–ˆë˜ ë¶€ë¶„ì„ ìë™ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ì¡°ì •ë˜ì—ˆë‹¤.
- ë©”ëª¨ë¦¬ ê´€ë¦¬ê°€ ì¡°ê¸ˆ ë” ê°„í¸í•´ì¡Œë‹¤.

## Strong 
- ì˜¤ë„ˆì‰½ì„ ê°€ì§„ ê°ì²´
- strong is â€œnormalâ€ reference counting

## Weak 
- ì ì„  í¬ì¸í„°: í™ ì˜ì—­ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ë¦¬í‚¤ê³  ìˆìœ¼ë‚˜, ì˜¤ë„ˆì‰½ì€ ì—†ìŒ
- strong í¬ì¸í„°ê°€ ì¸ìŠ¤í„´ìŠ¤ì™€ ì—°ê²°ì´ í•´ì œë˜ë©´, weak ë³€ìˆ˜ê°€ ê°€ë¦¬í‚¤ëŠ” ì¸ìŠ¤í„´ìŠ¤ê°€ ì—†ì–´ì§€ë©´ì„œ weakì€ nilì´ ë  ìˆ˜ ìˆìŒ
- if no one else is interested in this, then neither am I, **set me to nil in that case**
- A weak pointer will NEVER keep an object in the heap
- Because it has to be nil-able, weak only applies to **Optional pointers** to reference types
- Great example: **outlets (strongly held by the view hierarchy, so outlets can be weak)**


## Unowned
- unowned means â€œdonâ€™t reference count this; crash if Iâ€™m wrongâ€
- ì ˆëŒ€ nilì´ ì•„ë‹ˆë¼ê³  ê°œë°œìê°€ ë³´ì¥í•¨. 100% í™•ì‹¤í•  ë•Œë§Œ ì‚¬ìš©.

## ì°¸ê³ 
- weakì€ letìœ¼ë¡œ ì„ ì–¸ì´ ì•ˆë¨.
- UI ì†ì„±ë“¤ì€ ëª¨ë‘ weakìœ¼ë¡œ ì„ ì–¸í•˜ëŠ”ê²Œ ì¢‹ìŒ: ê¸°ë³¸ì ìœ¼ë¡œ self.viewê°€ strongìœ¼ë¡œ subViewë“¤ì„ ê°–ê³  ìˆê¸° ë•Œë¬¸.

## ìƒ˜í”Œì½”ë“œ
- Closures are stored in the heap as well (i.e. they are reference types). What is more, they â€œcaptureâ€ variables they use from the surrounding code into the heap too. Those captured variables need to stay in the heap as long as the closure stays in the heap. This can create a memory cycle.
- ë•Œë¬¸ì—, ìˆœí™˜ ì°¸ì¡°ë¥¼ ë§‰ê¸° ìœ„í•´, ê°’ì„ ìº¡ì³í•˜ëŠ” í´ë¡œì € ë‚´ë¶€ì—ì„œëŠ” ì™¸ë¶€ì˜ referenceíƒ€ì… propertyì— ëŒ€í•´ weak ë˜ëŠ” unownedë¡œ ì„ ì–¸í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

```
addUnaryOperation("âœ…â€){ [weak self] in 
	self?.display.textColor = UIColor.green
	return sqrt($0)}

```


### Resources
- [Xcode Instruments](https://developer.apple.com/library/content/documentation/DeveloperTools/Conceptual/InstrumentsUserGuide/index.html)


